<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.O.R. Basilicata - AI Assisted</title>
    <style>
        :root {
            --colore-primario: #2c3e50;
            --colore-secondario: #34495e;
            --colore-accento: #3498db;
            --colore-sfondo: #f0f2f5;
            --colore-testo: #333;
            --ai-bg: #ffffff;
            --ai-bubble: #e8f4fd;
            --allerta-verde: #27ae60;
            --allerta-gialla: #f1c40f;
            --allerta-arancione: #e67e22;
            --allerta-rossa: #c0392b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            background-color: var(--colore-sfondo);
            overflow: hidden; /* Evita scroll bar sul body */
        }

        /* --- COLONNA 1: MENU --- */
        #menu-rischi {
            width: 300px;
            min-width: 300px;
            background-color: var(--colore-primario);
            color: white;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }

        #logo-container {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            width: 100%;
            text-align: center;
        }

        #logo-container img {
            max-width: 120px;
            height: auto;
            display: block;
            margin: 0 auto;
            border-radius: 50%; /* Tocco estetico se non c'è logo */
            background: #fff;
            padding: 10px;
        }

        #menu-rischi h2 {
            font-size: 1.2rem;
            text-align: center;
            border-bottom: 2px solid var(--colore-accento);
            padding-bottom: 10px;
            margin-top: 10px;
            width: 100%;
        }

        #menu-rischi button {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
            background-color: var(--colore-secondario);
            color: white;
            border: none;
            border-left: 4px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            text-align: left;
            font-size: 15px;
            transition: all 0.2s;
        }

        #menu-rischi button:hover {
            background-color: #4e6a85;
            padding-left: 18px;
        }

        #menu-rischi button.active {
            background-color: #3e5871;
            border-left: 4px solid var(--colore-accento);
            font-weight: bold;
        }

        /* --- COLONNA 2: PROCEDURA (CENTRALE) --- */
        #contenuto-procedura {
            flex-grow: 1;
            padding: 40px;
            overflow-y: auto;
            background: white;
            border-right: 1px solid #ddd;
        }

        .scheda {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
            max-width: 900px; /* Per non avere righe troppo lunghe */
            margin: 0 auto;
        }

        .scheda.active { display: block; }

        .scheda h1 { color: var(--colore-primario); border-bottom: 2px solid #eee; padding-bottom: 15px; font-size: 2rem;}
        .scheda h3 { color: var(--colore-accento); margin-top: 30px; font-size: 1.4rem; }
        .scheda h4 { color: var(--colore-primario); margin-top: 20px; font-weight: 700; }
        .scheda p, .scheda li { font-size: 1.1rem; line-height: 1.6; color: #444; }
        
        .scheda ul { list-style-type: none; padding-left: 20px; }
        .scheda ul li::before { content: "✓"; color: var(--colore-accento); font-weight: bold; display: inline-block; width: 1.2em; margin-left: -1.2em; }
        .scheda li { margin-bottom: 10px; }
        
        .contatto {
            background-color: #f8f9fa;
            border-left: 4px solid var(--colore-secondario);
            padding: 12px;
            margin: 10px 0;
            border-radius: 0 4px 4px 0;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
        }

        /* --- COLONNA 3: AI ASSISTANT (DESTRA) --- */
        #ai-assistant {
            width: 350px;
            min-width: 350px;
            background-color: var(--ai-bg);
            border-left: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            box-shadow: -2px 0 10px rgba(0,0,0,0.05);
        }

        #ai-header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #ai-icon {
            font-size: 24px;
            background: white;
            color: var(--colore-accento);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        #ai-body {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #fcfcfc;
        }

        .ai-message {
            background-color: var(--ai-bubble);
            padding: 15px;
            border-radius: 12px;
            border-bottom-left-radius: 2px;
            margin-bottom: 15px;
            font-size: 0.95rem;
            line-height: 1.5;
            color: #2c3e50;
            border: 1px solid #d6eaf8;
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
            animation: slideIn 0.3s;
        }

        .ai-alert {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-suggestion-chip {
            display: inline-block;
            background: white;
            border: 1px solid var(--colore-accento);
            color: var(--colore-accento);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin: 5px 2px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ai-suggestion-chip:hover {
            background: var(--colore-accento);
            color: white;
        }

        .typing-indicator {
            font-style: italic;
            color: #888;
            font-size: 0.8rem;
            margin-bottom: 10px;
            display: none;
        }

        /* Utility */
        .allerta-verde { border-color: var(--allerta-verde); color: var(--allerta-verde); }
        .allerta-gialla { border-color: var(--allerta-gialla); color: var(--allerta-gialla); }
        .allerta-arancione { border-color: var(--allerta-arancione); color: var(--allerta-arancione); }
        .allerta-rossa { border-color: var(--allerta-rossa); color: var(--allerta-rossa); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(10px); } to { opacity: 1; transform: translateX(0); } }

    </style>
</head>
<body>

    <div id="menu-rischi">
        <div id="logo-container">
            <svg width="80" height="80" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="45" fill="white"/>
                <path d="M50 20L80 70H20L50 20Z" fill="#e67e22"/>
            </svg>
            <h3 style="margin:10px 0 0 0; font-size:1rem;">Sala Operativa<br>Regione Basilicata</h3>
        </div>
        
        <h2>Procedure Attive</h2>
        <button onclick="gestisciClick('criticita')" data-target="criticita">Bollettino Criticità</button>
        <button onclick="gestisciClick('avviso_criticita')" data-target="avviso_criticita">Avviso Criticità</button>
        <button onclick="gestisciClick('meteo_avverse')" data-target="meteo_avverse">Avviso Meteo Avverse</button>
        <button onclick="gestisciClick('valanghe')" data-target="valanghe">Bollettino Valanghe</button>
        <button onclick="gestisciClick('rischio_idraulico')" data-target="rischio_idraulico">Rischio Idraulico</button>
        <button onclick="gestisciClick('rischio_idrogeologico')" data-target="rischio_idrogeologico">Rischio Idrogeologico</button>
        <button onclick="gestisciClick('dighe')" data-target="dighe">Rischio Grandi Dighe</button>
        <button onclick="gestisciClick('frana_maratea')" data-target="frana_maratea">Criticità Frana Maratea</button>
        <button onclick="gestisciClick('sismico')" data-target="sismico">Rischio Sismico</button>
        <button onclick="gestisciClick('incendi')" data-target="incendi">Incidente Rilevante</button>
        <button onclick="gestisciClick('persone_scomparse')" data-target="persone_scomparse">Persone Scomparse</button>
        <button onclick="gestisciClick('maremoto')" data-target="maremoto">Rischio Maremoto</button>
    </div>

    <div id="contenuto-procedura">
        
        <div id="placeholder" class="scheda active">
            <h1>S.O.R. Basilicata - Home</h1>
            <p style="font-size: 20px;">Seleziona una procedura dal menu a sinistra.</p>
            <p>L'Assistente IA sulla destra ti fornirà supporto contestuale in tempo reale.</p>
        </div>

        <div id="criticita" class="scheda">
            <h1>Gestione Bollettino di Criticità Regionale</h1>
            <p><strong>Ricezione:</strong> Ricevuto il <strong>Bollettino di Criticità Regionale</strong>, emesso dal C.F.D. Basilicata.</p>
            <h3>Inoltro ai destinatari</h3>
            <h4>Accesso al sito</h4>
            <ul>
                <li>Accedere al sito <a href="#">protezionecivile.regione.basilicata.it</a>.</li>
                <li>Sezione “Invio Mail Rischio Idrogeologico”: cliccare “<strong>Invia mail di notifica</strong>”.</li>
            </ul>
            <h4>Pubblicazione TELEGRAM / WHATSAPP</h4>
            <ul>
                <li>Gruppo “Protezione Civile Basilicata”: incollare testo standard.</li>
                <li>Canali Whatsapp: Incollare link bollettino.</li>
            </ul>
        </div>

        <div id="sismico" class="scheda">
            <h1>Gestione Rischio Sismico</h1>
            <h3>Fase 1: Monitoraggio</h3>
            <ul>
                <li>Consultare INGV Terremoti: <a href="http://terremoti.ingv.it" target="_blank">terremoti.ingv.it</a>.</li>
            </ul>
            <h3>Fase 2: Attivazione (ML >= 3)</h3>
            <ul>
                <li><strong>Contattare telefonicamente TUTTI i comuni</strong> (raggio 20 km).</li>
                <li>Acquisire segnalazioni danni.</li>
            </ul>
        </div>
        
        <div id="frana_maratea" class="scheda">
             <h1>Gestione Criticità Frana Maratea</h1>
             <h3>Contatti Prioritari</h3>
             <ul>
                 <li class="contatto">Commissario: 339 2011917</li>
                 <li class="contatto">VV.UU. Maratea: 0973 877982</li>
             </ul>
        </div>

    </div>

    <div id="ai-assistant">
        <div id="ai-header">
            <div id="ai-icon">AI</div>
            <div>
                <div style="font-weight: bold;">Supporto Operativo</div>
                <div style="font-size: 0.8rem; opacity: 0.9;">Sempre attivo</div>
            </div>
        </div>
        
        <div id="ai-body">
            <div class="ai-message">
                Ciao! Sono il tuo assistente virtuale per la Sala Operativa.
                <br><br>
                Seleziona una procedura e ti aiuterò a controllare i passaggi critici e a recuperare i numeri giusti.
            </div>
            <div id="typing-indicator" class="typing-indicator">L'assistente sta analizzando la procedura...</div>
            <div id="dynamic-ai-content"></div>
        </div>
    </div>

    <script>
        // DATABASE CONOSCENZA AI (Simulato)
        // Qui definiamo cosa dice l'IA per ogni scenario
        const aiKnowledgeBase = {
            'placeholder': {
                text: "Attendo istruzioni. Seleziona un rischio dal menu.",
                actions: []
            },
            'criticita': {
                text: "<strong>Nota Operativa:</strong> Ricorda che il bollettino deve essere inviato <em>prima</em> delle 14:00 per essere valido per il giorno successivo. Hai controllato se la PEC di ricezione è arrivata correttamente?",
                alert: "Verifica che il link nel messaggio Telegram sia cliccabile prima di inviare.",
                actions: ["Apri Webmail", "Apri Telegram Web", "Chiama C.F.D."]
            },
            'sismico': {
                text: "In caso di evento sismico, la velocità è tutto. <br>1. Verifica Magnitudo su INGV.<br>2. Se > 3.0 prepara il foglio presenze per le chiamate.",
                alert: "Attenzione: Non fidarti dei social media per la localizzazione. Usa solo dati INGV.",
                actions: ["Apri INGV", "Lista Comuni Raggio 20km"]
            },
            'frana_maratea': {
                text: "Per Maratea la situazione è delicata. Se i sensori pluviometrici superano la soglia, la chiamata al Commissario è prioritaria rispetto alla PEC.",
                alert: "Se il Commissario non risponde entro 5 min, chiama i Carabinieri di Maratea.",
                actions: ["Chiama Commissario", "Verifica Pluviometri"]
            },
            'rischio_idraulico': {
                text: "Hai ricevuto l'avviso di superamento soglia? Verifica subito quale fiume è interessato. Spesso il Sinni e l'Agri hanno tempi di corrivazione diversi.",
                alert: "Se è notte, privilegia la chiamata telefonica ai Sindaci rispetto a WhatsApp.",
                actions: ["Visualizza Idrometri", "Rubrica Sindaci"]
            },
            'incendi': {
                text: "Per rischio industriale (RIR), verifica subito la direzione del vento sul sito dell'Aeronautica per capire dove si sposterà la nube.",
                actions: ["Meteo AM", "Piano Emergenza Esterna"]
            }
            // Aggiungere qui altri casi o un default
        };

        function gestisciClick(idScheda) {
            // 1. Gestione UI classica (Mostra/Nascondi schede)
            mostraScheda(idScheda);
            
            // 2. Attivazione AI
            aggiornaAI(idScheda);
        }

        function mostraScheda(idScheda) {
            document.querySelectorAll('.scheda').forEach(scheda => scheda.classList.remove('active'));
            // Fallback se l'ID non esiste nel codice HTML di esempio
            const schedaDaMostrare = document.getElementById(idScheda);
            if (schedaDaMostrare) {
                schedaDaMostrare.classList.add('active');
            } else {
                // Se manca il div, ne mostro uno generico o rimango sul precedente
                console.log("Scheda non trovata nell'HTML: " + idScheda);
            }
            
            document.querySelectorAll('#menu-rischi button').forEach(bottone => {
                bottone.classList.toggle('active', bottone.getAttribute('data-target') === idScheda);
            });
        }

        function aggiornaAI(contextId) {
            const container = document.getElementById('dynamic-ai-content');
            const typing = document.getElementById('typing-indicator');
            
            // Pulisce il contenuto precedente
            container.innerHTML = '';
            typing.style.display = 'block';

            // Simula un tempo di "pensiero" dell'AI (600ms)
            setTimeout(() => {
                typing.style.display = 'none';
                
                // Recupera i dati dalla Knowledge Base
                const data = aiKnowledgeBase[contextId] || {
                    text: "Sto monitorando la procedura. Segui attentamente i passaggi a video.",
                    actions: ["Contatta Referente", "Logga Evento"]
                };

                // Costruisce l'HTML della risposta AI
                let htmlContent = '';

                // 1. Alert Box (se presente)
                if(data.alert) {
                    htmlContent += `
                        <div class="ai-alert">
                            <span style="font-size:1.2rem">⚠️</span>
                            <div>${data.alert}</div>
                        </div>
                    `;
                }

                // 2. Messaggio principale
                htmlContent += `<div class="ai-message">${data.text}</div>`;

                // 3. Chip azioni suggerite
                if(data.actions && data.actions.length > 0) {
                    htmlContent += `<div style="margin-top:10px; font-size:0.8rem; color:#666; margin-bottom:5px;">AZIONI SUGGERITE:</div>`;
                    data.actions.forEach(action => {
                        htmlContent += `<span class="ai-suggestion-chip" onclick="alert('Simulazione azione: ${action}')">${action}</span>`;
                    });
                }

                container.innerHTML = htmlContent;
                
                // Scrolla l'AI in fondo se c'è molto testo
                const aiBody = document.getElementById('ai-body');
                aiBody.scrollTop = aiBody.scrollHeight;

            }, 600);
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => gestisciClick('placeholder'));
    </script>

</body>
</html>
